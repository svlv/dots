#!/bin/sh

kelvinToCelsium()
{
  res=$(echo "scale=0; ($1 - 273.15)/1" | bc)
  echo "${res}Â°C"
}

getEmojiById()
{
  id=$1
  if [ $id -ge 200 ] && [ $id -le 232 ]; then # thunderstorm
    echo ğŸŒ©
  elif [ $id -ge 300 ] && [ $id -le 321 ]; then # drizzle
    echo ğŸŒ§
  elif [ $id -ge 500 ] && [ $id -le 531 ]; then # rain
    echo ğŸŒ§
  elif [ $id -ge 600 ] && [ $id -le 622 ]; then # snow
    echo â„ï¸
  elif [ $id -ge 700 ] && [ $id -le 781 ]; then # atmosphere
    echo ğŸŒ«ï¸
  elif [ $id -eq 800 ]; then # clear
    echo â˜€ï¸
  elif [ $id -ge 801 ] && [ $id -le 804 ]; then # clouds
    echo â˜ï¸
  fi
}

# vars city and token are used from private environment

data="$(curl -s "api.openweathermap.org/data/2.5/weather?q=${OW_CITY}&appid=${OW_TOKEN}")"
[ "$1" = "get" ] && echo "$data" | jq && exit 0

temp=$(echo "$data" | jq '.main.temp')
id=$(echo "$data" | jq '.weather[0].id')

emoji=$(getEmojiById "$id")
degree=$(kelvinToCelsium "$temp")

echo "${emoji} ${degree}"

